# include "netxpto_20180418.h"

# include "binary_source_20180723.h"
# include "add_20180620.h"
# include "sink_20180118.h"
# include "mutual_information_estimator_20180723.h"


int main(int argc, char*argv[]){

	// #####################################################################################################
	// ################################### System Input Parameters #########################################
	// #####################################################################################################
	double Perror{0.2};
	int m{ 0 };
	long double numberOfBits{ 100000 };
	// #####################################################################################################
	// ################################### Simulation Parameters ###########################################
	// #####################################################################################################

	// #####################################################################################################
	// ########################### Signals Declaration and Inicialization ##################################
	// #####################################################################################################
	Binary S1{ "S1.sgn" };
	Binary S2{ "S2.sgn" };
	Binary S3{ "S3.sgn" };
	Binary S4{ "S4.sgn" };
	Binary S5{ "S5.sgn" };

	
	// #####################################################################################################
	// ########################### Blocks Declaration and Inicialization ###################################
	// #####################################################################################################
	BinarySource B1{ vector <Signal*>{},vector <Signal*>{&S1, &S2} };
	B1.setProbabilityOfZero(0.5);
	B1.setMode(Random);
	B1.setNumberOfBits(numberOfBits);

	BinarySource B2{ vector <Signal*>{},vector <Signal*>{&S3} };
	B2.setProbabilityOfZero(1-Perror);
	B2.setMode(Random);
	B2.setNumberOfBits(numberOfBits);

	Add B3{ vector <Signal*>{&S1, &S3},vector <Signal*>{&S4} };

	MutualInformationEstimator B4{ vector <Signal*>{&S2, &S4},vector <Signal*>{&S5} };
	B4.setMidReportSize(m);

	Sink B5{ vector <Signal*>{&S5},vector <Signal*>{} };
	B5.setDisplayNumberOfSamples(true);
	
	// #####################################################################################################
	// ########################### System Declaration and Inicialization ###################################
	// #####################################################################################################

	System MainSystem{ vector<Block*> {&B1, &B2, &B3, &B4, &B5}};

	// #####################################################################################################
	// #################################### System Run #####################################################
	// #####################################################################################################
	
	MainSystem.run();

	return 0;

}